# 微服务相关资料
## 微服务架构下效率提升实践
### 演讲信息
王汶东 51信用卡研发技术总监  ArchSummit 全球架构师峰会
### 主要内容
#### 现状
51信用卡现在大概有600多个微服务，后端研发团队有300到400人。平均每个人负责两个服务。  
理想中的微服务非常简单且美好，但是现实中的微服务往往十分复杂。  

#### 服务拆分
从开发维护的角度考虑，本来多个程序员维护同一个单体应用可能会产生频繁的冲突，在把单体应用拆分为多个服务之后，每个程序员理想情况下应该每人负责开发一个服务，但是实际上因为任务分配等原因，每个人可能分别要对多个服务进行开发维护，会导致更多的冲突。  

这其实是业务架构的问题，不是微服务带来的问题。微服务会放大业务架构的缺点，导致很多问题。

但是其实业务架构做的非常好，但是因为拆分完之后同样一个任务相比之前需要更多人完成，其实是一种“隐性低效”，更难发现和解决。

#### 代码重用
微服务拆分后，代码重用会变得更加困难，因为为了一次简单的重用增加一次RPC调用是不太可取的，所以难以避免会导致重复代码的出现，这也会降低开发的效率，增加开发成本。

#### 微服务测试
现在企业大多关注集成测试，单体系统测试简单。微服务测试因为服务比较多，需要测试的接口也很多，而且因为服务与服务之间还有依赖，所以微服务架构会导致测试效率下降。
主要痛点：
1. 测试环境搭建成本过高
2. 测试环境的稳定性很难保障
3. 不是所有业务都适合自动化测试
  虽然搭建了CI/CA系统，但是实际上自动化测试用例超过50%的服务不到十分之一。  
  不做自动化测试的原因：
    1. 测试环境不稳定，不能保证自动化测试测试环境。
    2. 有时候维护自动化测试脚本的成本比手工测试还高。（没举例子，为什么？）
    3. 有些业务不适合自动化测试。


测试的手段：  
当一个下游服务被修改时，为了完成测试流程的正确性，需要将上游服务都部署一遍。采用工具等，但是会遇到定时任务，消息队列等方面的问题。  


#### 运维
1. 发布成本（粒度问题）
2. 线上问题排查
3. 配套体系建设（主要是监控系统TPS过高）
4. 基础组件升级

#### 服务治理

问题定位很复杂


#### 方案
成立架构委员会，增加微服务开发“成本“（新的微服务需要CTO审批）

#### 思考
1. 是否适合业务
2. 是否适合团队
