# K8s使用阿里云容器私有镜像服务

虽然dockerhub提供了镜像仓库服务，但是因为保密或者传输速度等需求，我们会寻找dockerhub的替代方案。这时很多人会选择自行搭建私有镜像仓库，目前主流的搭建私有镜像仓库的方式有：

1. 使用docker registry搭建简单的私有镜像仓库。
2. 使用Harbor搭建具有可视化界面和权限管理的镜像仓库。

后者还提供了使用docker安装和使用helm安装等多种安装方式，个人用户一般会选择第一种，企业用户一般会选择第二种。但是前者需要我们保证一台有较大存储空间的服务器始终处于运行状态，否则镜像仓库就会不可用，稳定性难以保证，而且服务器本身也有不小的开销。第二种方式同样有这个问题，而且配置比较复杂，企业用户可能不在乎这点开销和配置成本，但是对于一般用户来说为了一个镜像仓库折腾那么久完全得不偿失。

在使用阿里云服务器时，我发现了阿里云提供了免费的私有镜像服务，当云服务器为阿里云服务器时，使用阿里云的容器镜像仓库可以使用内网加速，而且不占用公网流量，当云服务器使用按量付费时也可以减少一点成本。

如果使用的服务器不是阿里云服务器，那么使用阿里云容器镜像服务时无法获得内网加速效果。

## 开通容器镜像服务















阿里云提供了镜像容器服务，可以当作私有镜像仓库使用。

但是我在使用的过程中发现了一些问题：阿里云镜像仓库提供了三种连接方式，公有网络，专有网络和经典网络。

但是在使用过程中我发现，使用北京的服务器在使用专有网络的时候可以以内网的速度进行上传。但是同在北京的集群服务器使用专有网络时无法拉取镜像。

最后发现问题在于命名空间`namespace`，不同命名空间的`secret`不能共享，所以当我在新的命名空间下面新建pod的时候，必须在对应的命名空间下新建`secret`才行。