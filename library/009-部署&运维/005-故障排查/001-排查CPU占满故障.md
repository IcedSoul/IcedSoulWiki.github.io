# 排查CPU占满故障

## 场景

面试时被问到了这个问题，回答得不是很好。

场景是现在有一个线上故障，有一台CPU被占满了导致服务不可用，如何排查和解决这个故障。



## 步骤

### 确定进程ID

首先可以通过`top`命令查看，然后按大写P键可以让进程按照从高到低排序。

然后就可以看到占用CPU比较高的进程的PID了。



### 查看线程使用情况

拿到进程PID之后，就可以查看这个进程创建的线程了，可以通过`top -Hp [PID]`来查看这个进程对应的线程的资源使用情况。可以发现一个或者几个线程占用了比较高的CPU，可以记下它们的PID。



然后把拿到的线程号转化为16进制。



### 查看堆栈信息

结合进程号和线程号，使用jstack命令在堆栈中找报错信息：

```shell
jstack -l <pid> | grep <thread-hex-id> -A 10
```



然后根据结果去看对应的代码实现该怎么优化。